<script>
  /* ======  Counter animation  ====== */
  document.querySelectorAll('.counter').forEach(counter => {
    const target = +counter.dataset.target;
    const inc = target / 200;
    const update = () => {
      const count = +counter.innerText.replace(/,/g, '');
      if (count < target) {
        counter.innerText = Math.ceil(count + inc).toLocaleString();
        requestAnimationFrame(update);
      } else {
        counter.innerText = target.toLocaleString();
      }
    };
    update();
  });

  /* ======  Annual pricing toggle  ====== */
  const toggle = document.getElementById('annualToggle');
  const grid = document.getElementById('pricingGrid');
  function setPricing(annual) {
    grid.querySelectorAll('.price-card').forEach(card => {
      const monthly = Number(card.dataset.monthly);
      const annualPrice = monthly * 10; // 2 months free
      const priceValue = card.querySelector('.price-value');
      const priceNote = card.querySelector('.price-note');
      if (annual) {
        priceValue.textContent = annualPrice.toLocaleString();
        priceNote.textContent = '/yr';
      } else {
        priceValue.textContent = monthly.toLocaleString();
        priceNote.textContent = '/mo';
      }
    });
  }
  toggle.addEventListener('change', () => setPricing(toggle.checked));
  setPricing(false); // start on monthly

  /* ======  Mobile nav toggler  ====== */
  const navToggle = document.querySelector('.toggler');
  const navLinks = document.getElementById('nav-links');
  navToggle.addEventListener('click', () => {
    navLinks.classList.toggle('open');
    navToggle.setAttribute('aria-expanded', navLinks.classList.contains('open'));
  });

  /* ======  Dynamic year  ====== */
  document.getElementById('year').textContent = new Date().getFullYear();

  /* ======  Lazy-load Calendly  ====== */
  const widget = document.querySelector('.calendly-inline-widget');
  if (widget && 'IntersectionObserver' in window) {
    const io = new IntersectionObserver((entries, ob) => {
      entries.forEach(en => {
        if (en.isIntersecting) {
          const s = document.createElement('script');
          s.src = 'https://assets.calendly.com/assets/external/widget.js';
          s.async = 1;
          widget.appendChild(s);
          ob.disconnect();
        }
      });
    }, { rootMargin: '100px 0px' });
    io.observe(widget);
  }
</script>
