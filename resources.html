<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>CL&C Terminal | Institutional Access</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 120'%3E%3Cpath d='M50 5 L90 25 V75 L50 115 L10 75 V25 L50 5Z' fill='%230f172a'/%3E%3Cpath d='M50 20 V100 M25 40 L75 40 M25 70 L75 70' stroke='%2310b981' stroke-width='2.5' stroke-linecap='round'/%3E%3Ccircle cx='50' cy='20' r='4.5' fill='%2310b981'/%3E%3Ccircle cx='50' cy='55' r='6' fill='%2310b981'/%3E%3Ccircle cx='50' cy='100' r='4.5' fill='%2310b981'/%3E%3Ccircle cx='25' cy='40' r='3' fill='%2310b981'/%3E%3Ccircle cx='75' cy='40' r='3' fill='%2310b981'/%3E%3C/svg%3E">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <style>
        :root { --bg-body: #0b0d11; --bg-panel: #151922; --border-color: #272e3b; --accent: #10b981; }
        
        /* SCROLL ENGINE */
        html, body { height: 100%; margin: 0; overflow: hidden; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-body); color: #e2e8f0; font-size: 13px; display: flex; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        
        .sidebar { background-color: #0f1218; border-right: 1px solid var(--border-color); width: 240px; display: flex; flex-direction: column; flex-shrink: 0; }
        .main-content { flex: 1; display: flex; flex-direction: column; height: 100vh; overflow: hidden; position: relative; }
        
        .scrollable-view { flex: 1; overflow-y: auto; padding: 40px; scroll-behavior: smooth; }
        
        .top-bar { height: 64px; border-bottom: 1px solid var(--border-color); background: #0f1218; display: flex; align-items: center; justify-content: space-between; padding: 0 32px; flex-shrink: 0; }
        
        .module { background: var(--bg-panel); border: 1px solid var(--border-color); display: flex; flex-direction: column; height: 100%; border-radius: 2px; transition: 0.2s; }
        .module:hover { border-color: var(--accent); }
        .module-header { padding: 16px; border-bottom: 1px solid var(--border-color); background: rgba(0,0,0,0.2); font-size: 10px; font-weight: 800; text-transform: uppercase; color: #64748b; letter-spacing: 0.1em; }
        .module-body { padding: 24px; flex: 1; display: flex; flex-direction: column; }
        
        .std-input { width: 100%; background: #0b0d11; border: 1px solid var(--border-color); color: white; padding: 12px; font-family: 'JetBrains Mono'; font-size: 12px; margin-top: 8px; border-radius: 0; }
        .std-input:focus { outline: none; border-color: var(--accent); }
        
        .btn-exec { width: 100%; background: #e2e8f0; color: #0b0d11; border: none; padding: 14px; font-weight: 800; font-size: 11px; text-transform: uppercase; margin-top: 24px; cursor: pointer; transition: 0.2s; letter-spacing: 0.1em; }
        .btn-exec:hover { background: var(--accent); color: white; }

        .btn-ai { background: #312e81; color: white; border: 1px solid #4f46e5; margin-top: 12px; }
        .btn-ai:hover { background: #4f46e5; border-color: #6366f1; }
        
        .data-readout { background: #000; padding: 16px; margin-top: 20px; display: none; border: 1px solid var(--border-color); border-left: 3px solid var(--accent); }
        .res-big { font-size: 1.5rem; font-weight: 700; color: white; display: block; margin-top: 4px; font-family: 'JetBrains Mono'; }
        
        .tab-btn { background: transparent; border: 1px solid var(--border-color); padding: 10px 20px; color: #64748b; font-size: 10px; font-weight: 800; cursor: pointer; margin-right: 8px; transition: 0.2s; border-radius: 0; margin-bottom: 8px; }
        .tab-btn.active { color: white; background: var(--accent); border-color: var(--accent); }

        .ai-output {
            margin-top: 16px; padding: 24px; background: #020617; border: 1px solid #1e293b; border-left: 4px solid #4f46e5;
            font-family: 'JetBrains Mono', monospace; font-size: 12px; color: #f8fafc; line-height: 1.8;
            white-space: pre-wrap; display: none; max-height: 500px; overflow-y: auto;
        }

        .loader {
            border: 2px solid #f3f3f3; border-radius: 50%; border-top: 2px solid #10b981;
            width: 12px; height: 12px; animation: spin 1s linear infinite; display: inline-block; margin-left: 5px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        @media (max-width: 1024px) { .sidebar { display: none; } }
    </style>
</head>
<body>

    <!-- SIDEBAR -->
    <aside class="sidebar">
        <div class="p-8 border-b border-white/5">
            <h1 class="font-bold text-xs uppercase text-white tracking-widest">CL&C Terminal</h1>
            <p class="mono text-[9px] text-slate-600 mt-2">Node_UK_LND_01 // SECURE</p>
        </div>
        <nav class="py-10 flex-1 px-4 space-y-2">
            <a href="#" class="flex items-center gap-4 px-6 py-3 text-emerald-500 bg-emerald-500/5 border border-emerald-500/20">
                <i class="fas fa-terminal text-xs"></i><span class="mono font-bold">Systems</span>
            </a>
            <a href="intelligence.html" class="flex items-center gap-4 px-6 py-3 text-slate-500 hover:text-white transition-colors">
                <i class="fas fa-database text-xs"></i><span class="mono">Briefings</span>
            </a>
            <a href="index.html" class="flex items-center gap-4 px-6 py-3 text-slate-500 hover:text-white transition-colors">
                <i class="fas fa-power-off text-xs"></i><span class="mono">Exit HQ</span>
            </a>
        </nav>
        <div class="p-8 text-[9px] mono text-slate-700 leading-relaxed border-t border-white/5 uppercase font-bold tracking-widest">
            API_STATUS: ACTIVE<br>ENCRYPTION: 256_BIT<br>VER: FY26_V10.0
        </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="main-content">
        <div class="top-bar">
            <div class="mono text-[10px] text-slate-500 font-bold uppercase tracking-widest">Mandate: Global_Diagnostic_Interface</div>
            <div class="flex items-center gap-6">
                <div class="flex items-center gap-2"><div class="w-1.5 h-1.5 bg-emerald-500 rounded-full animate-pulse"></div><span class="mono text-[10px] text-emerald-500 font-bold uppercase">LIVE_TELEMETRY</span></div>
            </div>
        </div>

        <div class="scrollable-view">
            
            <!-- MASTER DIAGNOSTIC -->
            <div class="mb-12 p-10 border border-emerald-500/30 bg-emerald-500/5 flex flex-col md:flex-row justify-between items-center gap-8">
                <div>
                    <span class="mono text-emerald-600 text-[9px] block mb-2 font-bold uppercase tracking-widest">Initialization Protocol</span>
                    <h2 class="text-2xl text-white font-bold mb-2 uppercase tracking-tight">90-Second Infrastructure Audit</h2>
                    <p class="text-slate-400 text-sm max-w-xl">Execute the technical forensic scan to identify supply-chain liability and working capital stagnation across all four sectors.</p>
                </div>
                <a href="audit.html" class="bg-emerald-600 text-white px-10 py-4 text-[11px] font-bold uppercase tracking-widest hover:bg-emerald-500 transition-all shadow-2xl">Initialize Scan</a>
            </div>

            <!-- SECTOR FILTERS -->
            <div class="flex flex-wrap border-b border-white/5 mb-12">
                <button class="tab-btn active" onclick="filter('all')">ALL_MODULES</button>
                <button class="tab-btn" onclick="filter('cons')">CONSTRUCTION</button>
                <button class="tab-btn" onclick="filter('log')">LOGISTICS</button>
                <button class="tab-btn" onclick="filter('risk')">RISK_SHIELD</button>
                <button class="tab-btn" onclick="filter('cap')">CAPITAL_ACCEL</button>
            </div>

            <!-- TOOLS GRID -->
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8" id="grid">
                
                <!-- AI COUNSEL -->
                <div class="module t-all border-l-4 border-l-indigo-500 col-span-1 md:col-span-2 lg:col-span-3">
                    <div class="module-header flex justify-between items-center">
                        <span>AI Regulatory Counsel // Technical Auditor</span>
                        <i class="fas fa-robot text-indigo-500"></i>
                    </div>
                    <div class="module-body">
                        <input type="text" id="ai-query" class="std-input" placeholder="e.g. Evidence requirement for Regulation 4 material exclusions?">
                        <div class="ai-output" id="ai-response"><div id="ai-text-content"></div></div>
                        <button class="btn-exec btn-ai" onclick="consultAI()">Execute Audit Query ✨</button>
                    </div>
                </div>

                <!-- DEBT ENFORCEMENT -->
                <div class="module t-cons t-risk">
                    <div class="module-header">Debt Enforcement (LBA)</div>
                    <div class="module-body">
                        <label class="mono text-[9px] text-slate-400">Principal Amount (£)</label>
                        <input type="number" id="rec-val" class="std-input" value="10000">
                        <label class="mono text-[9px] text-slate-400 mt-4 block">Days Overdue</label>
                        <input type="number" id="rec-days" class="std-input" value="30">
                        <div class="data-readout" id="res-rec"><span class="mono text-[9px] text-slate-500">Principal + Statutory Int.</span><div class="res-big text-emerald-400" id="val-rec">£0.00</div></div>
                        <button class="btn-exec" onclick="calcRec()">Calculate Recovery</button>
                        <button class="btn-exec btn-ai" onclick="draftLBA()">Draft Legal LBA ✨</button>
                    </div>
                </div>

                <!-- DIRECTOR YIELD -->
                <div class="module t-risk t-cap">
                    <div class="module-header">Director Yield (Div vs Salary)</div>
                    <div class="module-body">
                        <label class="mono text-[9px] text-slate-400">Gross Company Profit (£)</label>
                        <input type="number" id="div-profit" class="std-input" value="100000">
                        <div class="data-readout" id="res-div"><span class="mono text-[9px] text-slate-500">Optimal Net Take-Home</span><div class="res-big text-emerald-400" id="val-div">£0.00</div></div>
                        <button class="btn-exec" onclick="calcDiv()">Optimize Yield</button>
                    </div>
                </div>

                <!-- DRC VALIDATOR -->
                <div class="module t-cons t-risk">
                    <div class="module-header">DRC Logic Gate (VAT)</div>
                    <div class="module-body">
                        <label class="mono text-[9px] text-slate-400">Net Labour Value (£)</label>
                        <input type="number" id="drc-labour" class="std-input" value="5000">
                        <label class="mono text-[9px] text-slate-400 mt-4 block">Net Material Value (£)</label>
                        <input type="number" id="drc-mats" class="std-input" value="1000">
                        <div class="data-readout" id="res-drc"><span class="mono text-[9px] text-slate-500">Applicable VAT Status</span><div class="res-big text-amber-500 uppercase" style="font-size: 1rem;" id="val-drc">PENDING</div></div>
                        <button class="btn-exec" onclick="calcDRC()">Validate Logic</button>
                    </div>
                </div>

                <!-- ASSET AFFORDABILITY -->
                <div class="module t-cap t-all">
                    <div class="module-header">Asset Budget-First Model</div>
                    <div class="module-body">
                        <label class="mono text-[9px] text-slate-400">Max Monthly Repayment (£)</label>
                        <input type="number" id="cap-budget" class="std-input" value="1500">
                        <div class="data-readout" id="res-cap"><span class="mono text-[9px] text-slate-500">Maximum Purchase Power</span><div class="res-big text-sky-400" id="val-cap">£0.00</div></div>
                        <button class="btn-exec" onclick="calcCap()">Execute Model</button>
                    </div>
                </div>

                <!-- CREDIT STRESS -->
                <div class="module t-risk">
                    <div class="module-header">Credit Stress (Gearing)</div>
                    <div class="module-body">
                        <label class="mono text-[9px] text-slate-400">Total Debt (£)</label>
                        <input type="number" id="stress-debt" class="std-input" value="50000">
                        <label class="mono text-[9px] text-slate-400 mt-4 block">Net Assets (£)</label>
                        <input type="number" id="stress-assets" class="std-input" value="150000">
                        <div class="data-readout" id="res-stress"><span class="mono text-[9px] text-slate-500">Debt-to-Asset Ratio</span><div class="res-big text-white" id="val-stress">0.00%</div></div>
                        <button class="btn-exec" onclick="calcStress()">Calculate Ratio</button>
                    </div>
                </div>

                <!-- LOGISTICS PROBE -->
                <div class="module t-log t-risk">
                    <div class="module-header">Logistics Status Probe (IR35)</div>
                    <div class="module-body">
                        <label class="mono text-[9px] text-slate-400">Weekly Driver Pay (£)</label>
                        <input type="number" id="log-pay" class="std-input" value="1200">
                        <label class="mono text-[9px] text-slate-400 mt-4 block">No. of Drivers</label>
                        <input type="number" id="log-qty" class="std-input" value="5">
                        <div class="data-readout" id="res-log"><span class="mono text-[9px] text-slate-500">3-Year Liability Exposure</span><div class="res-big text-rose-500" id="val-log">£0.00</div></div>
                        <button class="btn-exec" onclick="calcLog()">Scrub Liability</button>
                    </div>
                </div>

            </div>

            <div class="h-64"></div>
        </div>
    </main>

    <script>
        const apiKey = ""; // Integrated via Environment

        const counselSystemPrompt = `You are the CL&C Regulatory Counsel. Structure your response as a Defensive Memorandum:
        1. REF_MANDATE: CLC-AUDIT-[RANDOM]
        2. EXECUTIVE SUMMARY: 2 sentences.
        3. LEGISLATIVE CITATION: Focus on UK Acts.
        4. THE LOGIC GATE: Step-by-step risk check.
        5. ACTIONABLE DIRECTIVE: Clear next step.`;

        // RETRY LOGIC ENGINE
        async function robustFetch(url, payload, retries = 5, delay = 1000) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (response.ok) return await response.json();
                } catch (e) {}
                await new Promise(res => setTimeout(res, delay));
                delay *= 2;
            }
            throw new Error("Uplink Failed.");
        }

        async function callGemini(userQuery, systemPrompt, outputId, btnElement) {
            if (!apiKey) {
                document.getElementById(outputId).style.display = 'block';
                document.getElementById(outputId).innerHTML = "API Key Missing.";
                return;
            }
            const originalBtnText = btnElement.innerText;
            btnElement.innerHTML = 'Analyzing <span class="loader"></span>';
            btnElement.disabled = true;

            const outputDiv = document.getElementById(outputId);
            outputDiv.style.display = 'block';
            const contentTarget = outputId === 'ai-response' ? document.getElementById('ai-text-content') : outputDiv;
            contentTarget.innerText = "Accessing Database...";

            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] }
            };

            try {
                const data = await robustFetch(url, payload);
                contentTarget.innerText = data.candidates?.[0]?.content?.parts?.[0]?.text || "No Data.";
            } catch (error) {
                contentTarget.innerText = "Error Connecting.";
            } finally {
                btnElement.innerHTML = originalBtnText;
                btnElement.disabled = false;
            }
        }

        function consultAI() {
            const query = document.getElementById('ai-query').value;
            if (!query) return;
            callGemini(query, counselSystemPrompt, 'ai-response', event.target);
        }

        function draftLBA() {
            const val = document.getElementById('rec-val').value;
            const days = document.getElementById('rec-days').value;
            const query = `Draft a clinical LBA for a construction debt of £${val} aged ${days} days. Cite statutory interest triggers.`;
            callGemini(query, counselSystemPrompt, 'ai-response', event.target); // Redirected to main AI box for density
        }

        // TOOL CALCULATORS
        function filter(s){
            document.querySelectorAll('.module').forEach(m => {
                if(s === 'all' || m.classList.contains('t-'+s)) m.style.display = 'flex';
                else m.style.display = 'none';
            });
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            if(event) event.target.classList.add('active');
        }

        function calcRec(){
            const v = Number(document.getElementById('rec-val').value);
            const d = Number(document.getElementById('rec-days').value);
            const interest = (v * 0.1275 * d / 365) + 100;
            document.getElementById('val-rec').innerText = '£' + (v + interest).toLocaleString('en-GB', {maximumFractionDigits: 2});
            document.getElementById('res-rec').style.display = 'block';
        }

        function calcDiv(){
            const p = Number(document.getElementById('div-profit').value);
            const corpTax = p * 0.25;
            const net = (p - corpTax) * 0.85; // Simplified effective rate for estimation
            document.getElementById('val-div').innerText = '£' + net.toLocaleString('en-GB', {maximumFractionDigits: 0});
            document.getElementById('res-div').style.display = 'block';
        }

        function calcDRC(){
            const l = Number(document.getElementById('drc-labour').value);
            const m = Number(document.getElementById('drc-mats').value);
            const ratio = (m / (l+m)) * 100;
            const res = ratio < 5 ? "STANDARD VAT (DRC N/A)" : "DOMESTIC REVERSE CHARGE";
            document.getElementById('val-drc').innerText = res;
            document.getElementById('res-drc').style.display = 'block';
        }

        function calcCap(){
            const b = Number(document.getElementById('cap-budget').value);
            const power = b * 48; // Estimated lending power based on budget
            document.getElementById('val-cap').innerText = '£' + power.toLocaleString('en-GB', {maximumFractionDigits: 0});
            document.getElementById('res-cap').style.display = 'block';
        }

        function calcStress(){
            const d = Number(document.getElementById('stress-debt').value);
            const a = Number(document.getElementById('stress-assets').value);
            const ratio = (d / a) * 100;
            document.getElementById('val-stress').innerText = ratio.toFixed(2) + '%';
            document.getElementById('res-stress').style.display = 'block';
        }

        function calcLog(){
            const p = Number(document.getElementById('log-pay').value);
            const q = Number(document.getElementById('log-qty').value);
            const risk = (p * q * 52 * 3) * 0.40;
            document.getElementById('val-log').innerText = '£' + risk.toLocaleString('en-GB', {maximumFractionDigits: 0});
            document.getElementById('res-log').style.display = 'block';
        }
    </script>
</body>
</html>
